using System;
using System.Drawing;
using System.Windows.Forms;

namespace WindowsFormsTodo
{
    public partial class MainForm : Form
    {
        private TextBox textBoxInput;
        private Button buttonAdd;
        private Button buttonRemove;
        private ListBox listBoxTodos;
        private Label labelCounter;
        private int todoCount = 0;

        public MainForm()
        {
            InitializeComponent();
        }

        private void InitializeComponent()
        {
            // フォームの設定
            this.Text = "Windows Forms Todo App";
            this.Size = new Size(400, 300);
            this.StartPosition = FormStartPosition.CenterScreen;
            this.BackColor = Color.LightBlue;

            // テキストボックス
            textBoxInput = new TextBox();
            textBoxInput.Location = new Point(20, 20);
            textBoxInput.Size = new Size(250, 23);
            textBoxInput.PlaceholderText = "やることを入力してね！";
            textBoxInput.KeyPress += TextBoxInput_KeyPress;

            // 追加ボタン
            buttonAdd = new Button();
            buttonAdd.Location = new Point(280, 20);
            buttonAdd.Size = new Size(80, 25);
            buttonAdd.Text = "追加";
            buttonAdd.BackColor = Color.Pink;
            buttonAdd.Click += ButtonAdd_Click;

            // 削除ボタン
            buttonRemove = new Button();
            buttonRemove.Location = new Point(280, 55);
            buttonRemove.Size = new Size(80, 25);
            buttonRemove.Text = "削除";
            buttonRemove.BackColor = Color.LightCoral;
            buttonRemove.Click += ButtonRemove_Click;

            // リストボックス
            listBoxTodos = new ListBox();
            listBoxTodos.Location = new Point(20, 90);
            listBoxTodos.Size = new Size(340, 120);
            listBoxTodos.BackColor = Color.White;

            // カウンターラベル
            labelCounter = new Label();
            labelCounter.Location = new Point(20, 220);
            labelCounter.Size = new Size(200, 20);
            labelCounter.Text = "総数: 0件";
            labelCounter.ForeColor = Color.DarkBlue;

            // コントロールをフォームに追加
            this.Controls.Add(textBoxInput);
            this.Controls.Add(buttonAdd);
            this.Controls.Add(buttonRemove);
            this.Controls.Add(listBoxTodos);
            this.Controls.Add(labelCounter);
        }

        private void TextBoxInput_KeyPress(object sender, KeyPressEventArgs e)
        {
            // Enterキーで追加
            if (e.KeyChar == (char)Keys.Enter)
            {
                AddTodo();
                e.Handled = true;
            }
        }

        private void ButtonAdd_Click(object sender, EventArgs e)
        {
            AddTodo();
        }

        private void ButtonRemove_Click(object sender, EventArgs e)
        {
            if (listBoxTodos.SelectedIndex >= 0)
            {
                listBoxTodos.Items.RemoveAt(listBoxTodos.SelectedIndex);
                todoCount--;
                UpdateCounter();
            }
            else
            {
                MessageBox.Show("削除する項目を選んでね！", "お知らせ", 
                               MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
        }

        private void AddTodo()
        {
            if (!string.IsNullOrWhiteSpace(textBoxInput.Text))
            {
                listBoxTodos.Items.Add($"{DateTime.Now:HH:mm} - {textBoxInput.Text}");
                textBoxInput.Clear();
                todoCount++;
                UpdateCounter();
            }
            else
            {
                MessageBox.Show("なんか入力してよ～！", "エラー", 
                               MessageBoxButtons.OK, MessageBoxIcon.Warning);
            }
        }

        private void UpdateCounter()
        {
            labelCounter.Text = $"総数: {todoCount}件";
        }
    }

    static class Program
    {
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }
}